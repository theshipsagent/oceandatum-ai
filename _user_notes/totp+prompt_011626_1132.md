You have access to the oceandatum.ai codebase. I'm adding a 3-day trial system 
with Time-based One-Time Password (TOTP) 2FA to prevent casual credential sharing.

REQUIREMENTS:

1. TOTP REGISTRATION FLOW
   - New user registers with email + password
   - Email validation occurs (use existing system)
   - After validation, show QR code (not mandatory, but encouraged)
   - User scans QR with ANY TOTP app (Google Authenticator, Microsoft Authenticator, Authy, etc.)
   - User enters 6-digit code to verify QR was scanned correctly
   - On verification success: trial account created, expires exactly 3 days from now
   - Store TOTP secret encrypted in database

2. LOGIN FLOW
   - User enters email + password (existing flow)
   - If login successful AND TOTP enabled: prompt for 6-digit code from authenticator app
   - Validate 6-digit code (accept codes from current time window + 1 previous/next window for clock drift)
   - Check trial expiration: if today > expiration_date, reject with "Trial expired" message
   - If valid: allow login

3. TRIAL EXPIRATION
   - Set expiration_date = registration_date + 3 days
   - On login attempt after expiration, show message: 
     "Your 3-day trial has expired. Request a new trial below."
   - Provide link to "Request New Trial" form

4. REQUEST NEW TRIAL FORM
   - Simple form: email + reason for new trial (textarea)
   - On submit:
     a) Send email to [YOUR EMAIL] with their email + reason
     b) Show user: "Request received. You'll hear back within [X hours]"
   - Store request in database (optional, but helpful for tracking)

5. ADMIN RESET PROCESS (YOU)
   - When you receive trial request email, review reason
   - If approved: run simple command or use admin panel to:
     a) Delete old trial record for that email (if exists)
     b) Create NEW trial expiring 3 days from today
     c) Send user email: "Your trial has been approved and reset"
   - If denied: reply to their email with reason (manual, no system needed)

6. DATABASE CHANGES
   - Add to User model:
     * totp_secret (encrypted string, nullable)
     * totp_enabled (boolean, default false)
     * trial_start_date (timestamp, nullable)
     * trial_expiration_date (timestamp, nullable)
     * is_trial_user (boolean, default true for new users)
   - Create TrialRequest table:
     * id
     * user_email
     * reason
     * created_at
     * status (pending/approved/denied)
     * responded_at (nullable)

7. REQUIRED ENDPOINTS
   - POST /api/auth/register (modify existing to set trial dates)
   - POST /api/auth/totp/setup (generate QR code + secret)
   - POST /api/auth/totp/verify (verify 6-digit code during setup)
   - POST /api/auth/login (modify existing to check TOTP if enabled)
   - POST /api/auth/totp/validate-login (validate TOTP code on login)
   - POST /api/trial/request-new (submit request new trial form)
   - POST /api/admin/trial/reset (admin endpoint: reset user's trial - SECURE THIS)

8. FRONTEND COMPONENTS NEEDED
   - Registration → After email validation, show:
     * "Enable Authenticator (Recommended)" button
     * If clicked: show QR code + instructions
     * Input field for 6-digit code
     * Confirm button
   - Login → After password success:
     * If TOTP enabled: show input field for 6-digit code
     * "Enter code from your authenticator app"
   - Expired Trial Page:
     * "Your 3-day trial has ended"
     * "Request New Trial" button/link
   - Request New Trial Form:
     * Email field (pre-filled if logged in)
     * Reason textarea
     * Submit button
     * Success message after submit

9. LIBRARIES NEEDED
   - speakeasy (Node) or pyotp (Python) - TOTP generation/validation
   - qrcode (or qrcode.react if React) - QR code rendering
   - nodemailer or existing email service - send emails

10. SECURITY NOTES
    - Encrypt TOTP secret in database (don't store plaintext)
    - TOTP validation should allow 30-second time window drift (current + 1 prev/next)
    - Admin reset endpoint should be protected (authentication required, maybe IP whitelist)
    - Trial request form should have rate limiting (max 1 request per email per day)
    - Don't log TOTP secrets in error messages

11. CONFIGURATION
    - Set trial length = 3 days (make configurable in .env if possible)
    - Set email recipient for trial requests = [YOUR EMAIL FROM .env]
    - TOTP app name in QR = "DATUM" (shows in authenticator app)

IMPLEMENTATION APPROACH:
1. First, analyze current auth system and database schema
2. Design database migrations for new fields
3. Implement TOTP library integration (secret generation, validation)
4. Build QR code generation during registration
5. Modify login flow to check TOTP + expiration
6. Build trial request form and email notification
7. Build admin reset endpoint
8. Create frontend components for all flows
9. Test: full registration → TOTP setup → login with TOTP → trial expiration
10. Test: request new trial → admin reset

DELIVERABLES:
- Complete, working code (not pseudo-code)
- All necessary database migrations
- All API endpoints
- All frontend components
- Environment variable configuration template
- Testing instructions
- Deployment checklist

Start by analyzing the current codebase structure, auth system, database schema, 
and email configuration. Then provide complete implementation.